---
# Copyright 2017 IBM Corp.
#
# All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.


# This file is the master reference for the format of the config
# and inventory file.
#
# Its purpose is to act as the authoritative source on key names,
# structure, and representative values.

version: 1.1

log_level: debug
deployer-gateway: true  # deployer will be configured as the default gateway for all client nodes
deployment-environment:
    https_proxy: "http://192.168.1.2:3128"
    http_proxy: "http://192.168.1.2:3128"
    no_proxy: "localhost,127.0.0.1"
ipaddr-mgmt-network: 192.168.16.0/20   # 4096 addresses
ipaddr-mgmt-switch:
    rack1: 192.168.16.2
    rack2: 192.168.16.3
    rack3: 192.168.16.4
label-mgmt-switch-external-dev: enp1s0f0
cidr-mgmt-switch-external-dev: 192.168.1.10/24
ipaddr-mgmt-switch-external:
    _rack1: 192.168.1.11
ipaddr-data-switch: # Without MLAG, can be string or list with a single element
    rack1: 192.168.16.20
    rack2:
        - 192.168.16.25
    rack3: 192.168.16.30
ipaddr-data-switch: # With MLAG, must be list with two elements
    rack1:
        - 192.168.16.25
        - 192.168.16.26
ipaddr-mlag-vip:
    _rack1: 192.168.16.254
cidr-mlag-ipl:
    _rack1:
        - 10.0.0.1/24
        - 10.0.0.2/24
mlag-vlan:
    rack1: 4000
mlag-port-channel:
    rack1: 6
mlag-ipl-ports:
    rack1:
        -
            - 7
            - 8
        -
            - 7
            - 8
redundant-network: false
write-switch-memory: true
userid-default: user
password-default: passw0rd
# An encrypted password hash can also be provided using the following format:
# password-default-crypted: $6$STFB8U/AyA$sVhg5a/2RvDiXof9EhADVcUm/7Tq8T4m0dcdHLFZkOr.pCjJr2eH8RS56W7ZUWw6Zsm2sKrkcS4Xc8910JMOw.
userid-mgmt-switch: user        # applied to all mgmt switches
password-mgmt-switch: passw0rd  # applied to all mgmt switches
userid-data-switch: user
password-data-switch: passw0rd
internal-floating-ipaddr: 1.2.3.4/22
external-floating-ipaddr: 1.2.3.5/22
networks:
    external1:
        description: Organization site or external network
        addr: 10.0.16.0/22
        available-ips:
            - 10.0.16.20
            - 10.0.16.35
            - 10.0.16.106 10.0.16.110
            - 10.0.16.115
        broadcast: 10.0.16.255
        gateway: 10.0.16.1
        dns-nameservers: 10.0.16.200
        dns-search: mycompany.domain.com
        method: static
        eth-port: eth10
        mtu: 9000
    external2:
        description: Interface for eth11
        method: manual
        eth-port: eth11
    base-eth0:
        description: Interface for eth0
        method: manual
        eth-port: eth0
    base-eth1:
        description: Interface for eth1
        method: manual
        eth-port: eth1
    pxe-dhcp:
        description: Change pxe port(eth15) to dhcp
        method: dhcp
        eth-port: eth15
    standalone-bond0:
        description: Multilink bond
        bond: mybond0
        addr: 10.0.16.0/22
        broadcast: 10.0.16.255
        gateway: 10.0.16.1
        dns-nameservers: 10.0.16.200
        dns-search: mycompany.domain.com
        method: static
        #name of physical interfaces to bond together.
        bond-interfaces:
            - eth0
            - eth1
        #if necessary not all bond modes support a primary slave
        bond-primary: eth10
        #bond-mode, needs to be one of 7 types
        # either name or number can be used.
        #0 balance-rr
        #1 active-backup
        #2 balance-xor
        #3 broadcast
        #4 802.3ad
        #5 balance-tlb
        #6 balance-alb
        #bond-mode: active-backup
        bond-mode: 1
        #there is a long list of optional bond arguments.
        #Specify them here and they will be added to end of bond definition
        optional-bond-arguments:
            bond-miimon: 100
            bond-lacp-rate: 1
    manual-bond1:
        description: bond network to be used by future bridges
        bond: bond1
        method: manual
        bond-mode: balance-rr
        bond-interfaces:
              - eth10
              - eth11
    openstack-mgmt:
        description: OpenStack Management Network
        bridge: br-mgmt
        method: static
        tcp_segmentation_offload: off
        addr: 172.29.236.0/22  # ipv4 openstack management network
        vlan: 10
        eth-port: bond1
    openstack-stg:
        description: OpenStack Management Network
        bridge: br-storage
        method: static
        tcp_segmentation_offload: off
        addr: 172.29.244.0/22  # ipv4 openstack storage network
        vlan: 20
        eth-port: eth10
    openstack-tenant-vxlan:
        description: OpenStack Tenant vxlan Network
        bridge: br-vxlan
        method: static
        addr: 172.29.240.0/22  # ipv4 openstack tenant network
        vlan: 30     # vxlan vlan id
        eth-port: eth11
        bridge-port: veth12
    openstack-tenant-vlan:
        description: OpenStack Tenant vlan Network
        bridge: br-vlan
        method: static
        addr: 0.0.0.0/1  # Nodes do not get IPs assigned in this network
        eth-port: eth11
racks:   # This information is optional (not required to be present)
    - rack-id: rack1
      data-center: dataeast
      room: room33
      row: row1
switches:
    mgmt:  # single management switch (single rack) for first release
        - hostname: mgmtswitch1
          ipv4-addr: 10.0.16.2
          userid: joeuser
          password: letmein
          rack-id: rack1
          rack-eia: 39
          model: G8052
          serial-number: abc123
    leaf:    # single leaf switch for first release
        - hostname: leafswitch1
          ipv4-addr: 10.0.16.3
          userid: joeuser
          password: letmein
          rack-id: rack1
          rack-eia: 40
          model: SX1410
          serial-number: cde234
# spine switches not supported in first release
node-templates:
    controllers:
        hostname: hostname seed
        userid-ipmi: userid
        password-ipmi: password
        cobbler-profile: controllerx86
        name-interfaces:
            mac-pxe: eth15
            mac-eth10: eth10
            mac-eth11: eth11
        ports:
            pxe:
                rack1:
                    - 1/20
                    - 1/21
                    - 1/23
            ipmi:
                rack1:
                    - 1/41
                    - 1/42
                    - 1/43
            eth10:
                rack1:
                    - 1/2
                    - 1/3
                    - 1/5
            eth11:
                rack1:
                    - 1/12
                    - 1/13
                    - 1/15
        networks:
            - openstack-mgmt
            - openstack-stg
            - openstack-tenant-vlan
            - openstack-tenant-vxlan
            - external1
            - external2
            - pxe-dhcp
    compute:
        hostname: hostname seed
        userid-ipmi: userid
        password-ipmi: password
        cobbler-profile: computeppc64le
        name-interfaces:
            mac-pxe: eth15
            mac-eth10: eth10
            mac-eth11: eth11
        ports:
            pxe:
                rack1:
                    - 1/20
                    - 1/21
                    - 1/23
            ipmi:
                rack1:
                    - 1/41
                    - 1/42
                    - 1/43
            eth10:
                rack1:
                    - 1/2
                    - 1/3
                    - 1/5
            eth11:
                rack1:
                    - 1/12
                    - 1/13
                    - 1/15
        networks:
            - openstack-mgmt
            - openstack-stg
            - openstack-tenant-vlan
            - openstack-tenant-vxlan
            - external1
            - external2
            - pxe-dhcp
            - base-eth0
            - base-eth1
            - manual-bond1
            - standalone-bond0

software-bootstrap:
    all: apt-get update
    compute[0]: |
        apt-get update
        apt-get upgrade -y

nodes:
    controllers:     # OpenStack controller nodes
        - hostname: controller1  # (associated with external1-addr below)
          external1-addr: 10.0.16.20  # on the eth10 interface
          external2-addr: ''
          template: controller
          userid: janeuser
          rack-id: rack1
          rack-eia: 8
          chassis-part-number: xyz123       # ipmi field value
          chassis-serial-number: abcd-1234  # ipmi field value
          model: RD550             # ipmi field value
          serial-number: abcd1234  # ipmi field value
          ipv4-ipmi: 192.168.16.200
          mac-ipmi: 11:22:33:44:55:66  # mac address of the ipmi port
          userid-ipmi: joeuser      # userid for logging into the ipmi port
          password-ipmi: joeuserpw  # password for logging into the ipmi port
          switch-port-ipmi: 2
          ipv4-pxe: 192.168.16.220
          mac-pxe: 22:33:44:55:66:77
          mac-eth10: 32:33:44:55:66:77
          mac-eth11: 42:33:44:55:66:77
          switch-port-pxe: 10
          openstack-mgmt-addr: 172.29.236.2
          openstack-stg-addr: 172.29.244.2
          openstack-tenant-vlxan-addr: 172.29.240.2
          openstack-tenant-vlan-addr: 0.0.0.0
        - hostname: controller2  # (associated with external1-addr below)
          external1-addr: 10.0.16.35  # on the eth10 interface
          external2-addr: ''
          template: controller
          userid: janeuser
          rack-id: rack1
          rack-eia: 9
          chassis-part-number: xyz123       # ipmi field value
          chassis-serial-number: abcd-1235  # ipmi field value
          model: RD550             # ipmi field value
          serial-number: abcd1235  # ipmi field value
          ipv4-ipmi: 192.168.16.201
          mac-ipmi: 11:22:33:44:55:67  # mac address of the ipmi port
          userid-ipmi: joeuser      # userid for logging into the ipmi port
          password-ipmi: joeuserpw  # password for logging into the ipmi port
          switch-port-ipmi: 3
          ipv4-pxe: 192.168.16.220
          mac-pxe: 22:33:44:55:66:78
          mac-eth10: 32:33:44:55:66:78
          mac-eth11: 42:33:44:55:66:78
          switch-port-pxe: 11
          openstack-mgmt-addr: 172.29.236.3
          openstack-stg-addr: 172.29.244.3
          openstack-tenant-vlxan-addr: 172.29.240.3
          openstack-tenant-vlan-addr: 0.0.0.0
        - hostname: controller3  # (associated with external1-addr below)
          external1-addr: 10.0.16.106  # on the eth10 interface
          external2-addr: ''
          template: controller
          userid: janeuser
          rack-id: rack1
          rack-eia: 10
          chassis-part-number: xyz123       # ipmi field value
          chassis-serial-number: abcd-1234  # ipmi field value
          model: RD550             # ipmi field value
          serial-number: abcd1234  # ipmi field value
          ipv4-ipmi: 192.168.16.202
          mac-ipmi: 11:22:33:44:55:66  # mac address of the ipmi port
          userid-ipmi: joeuser      # userid for logging into the ipmi port
          password-ipmi: joeuserpw  # password for logging into the ipmi port
          switch-port-ipmi: 4
          ipv4-pxe: 192.168.16.220
          mac-pxe: 22:33:44:55:66:79
          mac-eth10: 32:33:44:55:66:79
          mac-eth11: 42:33:44:55:66:79
          switch-port-pxe: 12
          openstack-mgmt-addr: 172.29.236.4
          openstack-stg-addr: 172.29.244.4
          openstack-tenant-vlxan-addr: 172.29.240.4
          openstack-tenant-vlan-addr: 0.0.0.0
    compute:    # OpenStack compute nodes
        - hostname: compute1
          external1-addr: 10.0.16.107  # on the eth10 port
          external2-addr: ''
          template: compute
          userid: janeuser
          rack-id: rack1
          rack-eia: 11
          chassis-part-number: 8335-GCA  # ipmi field value
          chassis-serial-number: abc124  # ipmi field value
          # Note: 8335 model and serial-number not present in ipmi
          ipv4-ipmi: 192.168.16.203
          mac-ipmi: 11:22:33:44:55:67
          userid-ipmi: joeuser
          password-ipmi: joeuserpw
          switch-port-ipmi: 5
          ipv4-pxe: 192.168.16.223
          mac-pxe: 11:22:33:44:55:68
          mac-eth10: 32:33:44:55:66:80
          mac-eth11: 42:33:44:55:66:80
          switch-port-pxe: 13
          openstack-mgmt-addr: 172.29.236.5          # ipv4 management network
          openstack-stg-addr: 172.29.244.5           # ipv4 storage network
          openstack-tenant-vlxan-addr: 172.29.240.5  # ipv4 tenant network
          openstack-tenant-vlan-addr: 0.0.0.0
        - hostname: compute2
          external1-addr: 10.0.16.108  # on the eth10 port
          external2-addr: ''
          template: compute
          userid: janeuser
          rack-id: rack1
          rack-eia: 13
          chassis-part-number: 8335-GCA  # ipmi field value
          chassis-serial-number: abc125  # ipmi field value
          ipv4-ipmi: 192.168.16.204
          mac-ipmi: 11:22:33:44:55:69
          userid-ipmi: joeuser
          password-ipmi: joeuserpw
          switch-port-ipmi: 6
          ipv4-pxe: 192.168.16.224
          mac-pxe: 11:22:33:44:55:67
          mac-eth10: 32:33:44:55:66:90
          mac-eth11: 42:33:44:55:66:90
          switch-port-pxe: 14
          openstack-mgmt-addr: 172.29.236.6          # ipv4 management network
          openstack-stg-addr: 172.29.244.6           # ipv4 storage network
          openstack-tenant-vlxan-addr: 172.29.240.6  # ipv4 tenant network
          openstack-tenant-vlan-addr: 0.0.0.0
...
